<!DOCTYPE html>
<html>

<head>
    <title data-i18n="options_page_title">Speech Recognition Settings</title>
    <link rel="icon" type="image/png" href="images/microphone.png" id="favicon">
    <link rel="stylesheet" href="css/options.css">
    <meta charset="UTF-8" />
</head>

<body>
    <div class="container">
        <h3 data-i18n="options_heading">Speech Recognition Settings</h3>
        <div class="banner" id="top-warning-banner" data-i18n="banner_text">
            ⚠️ Alert: This is not a bandaid fix to the webspeech API. You can view voice-recognition status via the
            extension icon (pin it to your menu bar). Any additional information is listed <a
                href="https://github.com/apersongithub/Speech-Recognition-Polyfill"
                target="_blank"><strong data-i18n="link_here">HERE!</strong></a>
        </div>

        <div class="card">
            <div class="section-header">
                <span class="icon icon-sliders" aria-hidden="true"></span>
                <span data-i18n="section_engine">Engine</span>
            </div>
            <div class="note" data-i18n="engine_note">
                Whisper and Vosk both run locally; AssemblyAI sends audio to the cloud (requires API key).
            </div>
            <label data-i18n="engine_label">Provider</label>
            <select id="provider-select">
                <option value="local-whisper" data-i18n="engine_local">Whisper</option>
                <option value="vosk" data-i18n="engine_vosk">Vosk</option>
                <option value="assemblyai" data-i18n="engine_assemblyai">AssemblyAI</option>
            </select>
            <div class="note" data-i18n="show_engine_sections_note">Choose the provider your want.
            </div>

            <div class="checkbox-wrapper">
                <input type="checkbox" id="show-model-sections-toggle" />
                <label for="show-model-sections-toggle" class="checkbox-label"
                    data-i18n="show_engine_sections_label">Show engine-specific sections</label>
            </div>
            <div class="note" data-i18n="show_engine_sections_note">Sections auto-hide based on engine.
            </div>
            <div class="checkbox-wrapper">
                <input type="checkbox" id="cache-default-model" />
                <label for="cache-default-model" class="checkbox-label" data-i18n="cache_default_model_label">Cache
                    default model on startup</label>
            </div>
            <div class="note" data-i18n="cache_default_model_note">Prefetches your default local model so the
                initial use is faster (This will take up some RAM).</div>
            <div class="status" id="status-engine" data-i18n="status_saved">Saved</div>
        </div>

        <div class="card" id="card-local">
            <div class="section-header">
                <span class="icon icon-cpu" aria-hidden="true"></span>
                <span data-i18n="section_local_title">Whisper</span> <span class="pill"
                    data-i18n="pill_local">Local</span>
                    <span class="pill" data-i18n="pill_nostreaming" style="background:#fee2e2; border-color:#ef4444; color:#b91c1c;">
                        Streaming Unsupported
                    </span>
            </div>
            <div class="note" data-i18n="local_config_note">Configure local model, language, and silence timing.</div>
            <label data-i18n="ai_model">AI Model</label>
            <select id="model-select">
                <optgroup label="English Only" data-i18n="group_en_fast">
                    <option value="Xenova/whisper-tiny.en" data-i18n="model_tiny_en">Tiny English (~75MB)</option>
                    <option value="Xenova/whisper-base.en" data-i18n="model_base_en">Base English (~150MB)</option>
                    <option value="Xenova/distil-whisper-medium.en" data-i18n="model_distil_en">Distil-Medium English
                        (~600MB)</option>
                    <option value="Xenova/whisper-small.en" data-i18n="model_small_en">Small English (~500MB)</option>
                </optgroup>
                <optgroup label="Multilingual (General Purpose)" data-i18n="group_multi">
                    <option value="Xenova/whisper-tiny" data-i18n="model_tiny_multi">Tiny Multilingual (~150MB)</option>
                    <option value="Xenova/whisper-base" data-i18n="model_base_multi">Base Multilingual (~290MB)</option>
                    <option value="Xenova/whisper-small" data-i18n="model_small_multi">Small Multilingual (~1GB)
                    </option>
                </optgroup>
            </select>
            <div id="size-warning" class="warning"></div>

            <label data-i18n="language_label">Language</label>
            <select id="language-select">
                <option value="auto" data-i18n="lang_auto">Auto-Detect</option>
                <option value="en" data-i18n="lang_en">English</option>
                <option value="es" data-i18n="lang_es">Spanish</option>
                <option value="fr" data-i18n="lang_fr">French</option>
                <option value="de" data-i18n="lang_de">German</option>
                <option value="it" data-i18n="lang_it">Italian</option>
                <option value="pt" data-i18n="lang_pt">Portuguese</option>
                <option value="ja" data-i18n="lang_ja">Japanese</option>
                <option value="zh" data-i18n="lang_zh">Chinese</option>
                <option value="ru" data-i18n="lang_ru">Russian</option>
            </select>
            <div class="note" data-i18n="lang_note">The language the translator will attempt to decipher.</div>

            <div class="status" id="status-local" data-i18n="status_saved">Saved</div>
        </div>

        <div class="card" id="card-vosk">
            <div class="section-header">
                <span class="icon icon-cpu" aria-hidden="true"></span>
                <span data-i18n="section_vosk_title">Vosk</span> <span class="pill"
                    data-i18n="pill_local">Local</span>
                    <span class="pill" data-i18n="pill_streaming" style="background:#dcfce7;border-color:#86efac;">Streaming Supported</span>
            </div>
            <div class="note" data-i18n="vosk_config_note">Streaming local recognition using Vosk models.</div>
            <label data-i18n="vosk_model_label">Language Model</label>
            <input id="vosk-model-input" list="vosk-model-list" type="text"
                placeholder="Search Vosk models (type to filter)"  type="password" autocomplete="new-password" autocorrect="off" autocapitalize="off" spellcheck="false" data-lpignore="true"  />
            <div id="vosk-size-warning" class="warning"></div>
            <div class="note" data-i18n="vosk_streaming_note">Choose a LM, vosk streams audio in real-time for partial results.</div>
            <div class="status" id="status-vosk" data-i18n="status_saved">Saved</div>
        </div>

        <div class="card" id="card-cloud">
            <div class="section-header">
                <span class="icon icon-cloud" aria-hidden="true"></span>
                <span data-i18n="section_cloud_title">AssemblyAI</span>
                <span class="pill" style="background:#ecfeff;border-color:#a5f3fc;" data-i18n="pill_cloud">Cloud</span>
                <span class="pill" data-i18n="pill_streaming" style="background:#dcfce7;border-color:#86efac;">Streaming Supported</span>
            </div>
            <div class="note" data-i18n="cloud_key_note">Provide your AssemblyAI key to enable cloud transcription.
            </div>
            <label data-i18n="assemblyai_key_label">AssemblyAI API Key</label>
            <input id="assemblyai-key" type="password" data-i18n-placeholder="assemblyai_key_placeholder"
                placeholder="Ex: 68c0a2c49a4dc8e9c07b30dc8a9c06d" />
            <div class="note" data-i18n="assemblyai_key_note">
                Stored locally; used only when the cloud engine is selected. It is free but requires an account since
                speech data is sent to AssemblyAI for processing.
            </div>
            <div class="actions" style="margin-top:8px;">
                <button id="open-assemblyai" class="btn-secondary" type="button" data-i18n="assemblyai_get_key_btn">Get
                    an AssemblyAI API Key</button>
            </div>

            <div class="status" id="status-cloud" data-i18n="status_saved">Saved</div>
        </div>

                <div class="card">
            <div class="section-header">
                <span class="icon icon-mic" aria-hidden="true"></span>
                <span data-i18n="section_triggers">Speech Triggers</span>
            </div>
            <div class="note" data-i18n="triggers_note">Configure how speech capture is triggered and how results are submitted.</div>

            <label for="hotkey" style="margin-top:8px;" data-i18n="shortcut_hotkey_label">Keyboard shortcut</label>
            <input id="hotkey" type="text" data-i18n-placeholder="shortcut_hotkey_placeholder"
                placeholder="Click and press keys (Alt+A)" autocomplete="off" />
            <div class="note" data-i18n="shortcut_hotkey_note">Click, press the combo you want. Backspace/Delete to
                clear. Esc to disable shortcut. Empty disables.</div>

            <div class="checkbox-wrapper">
                <input type="checkbox" id="enable-shortcut" />
                <label for="enable-shortcut" class="checkbox-label" data-i18n="disable_speech_shortcut_label">Disable speech shortcut</label>
            </div>
            <div class="note" data-i18n="shortcut_enable_note">Pretty self explanatory...</div>

            <div class="checkbox-wrapper" style="margin-top:8px;">
                <input type="checkbox" id="send-enter-after" />
                <label for="send-enter-after" class="checkbox-label" data-i18n="send_enter_after_label">Send Enter after
                    inserting text</label>
            </div>
            <div class="note" data-i18n="send_enter_after_note">Automatically presses 'Enter' on the focused
                field right after text is inserted.</div>

                            <div class="checkbox-wrapper">
                <input type="checkbox" id="strip-trailing-period" />
                <label for="strip-trailing-period" class="checkbox-label"
                    data-i18n="strip_trailing_period_label">Disable trailing period removal</label>
            </div>
            <div class="note" data-i18n="strip_trailing_period_note">Removes a final “.” from recognized text.</div>

            <div class="checkbox-wrapper">
                <input type="checkbox" id="disable-space-normalization" />
                <label for="disable-space-normalization" class="checkbox-label" data-i18n="disable_space_normalization_label">
                    Disable space normalization between streaming turns
                </label>
            </div>
            <div class="note" data-i18n="disable_space_normalization_note">Prevents auto-inserting spaces when appending streaming results.</div>

            <div class="status" id="status-speech-triggers" data-i18n="status_saved">Saved</div>
        </div>

        <div class="card">
            <div class="section-header">
                <span class="icon icon-logic" aria-hidden="true"></span>
                <span data-i18n="section_logic">Speech Logic</span>
            </div>
            <div class="note" data-i18n="logic_note">Configure audio input, recording behavior, and streaming rules.</div>

            <label data-i18n="mic_gain_label">Mic gain</label>
            <div class="range-row">
                <input id="mic-gain" type="range" min="1" max="3" step="0.1" value="1.0" />
                <span class="range-value" id="mic-gain-value">1.0x</span>
            </div>
            <div class="note" data-i18n="mic_gain_note">Boosts mic input level for quieter microphones.</div>

            <label data-i18n="silence_sensitivity_label">Silence sensitivity</label>
            <div class="range-row">
                <input id="silence-sensitivity" type="range" min="6" max="18" step="1" value="12" />
                <span class="range-value" id="silence-sensitivity-value">12</span>
            </div>
            <div class="note" data-i18n="silence_sensitivity_note">Higher values require louder speech to keep
                recording.</div>

            <label data-i18n="silence_timeout">Silence Timeout (ms)</label>
            <input id="silence-timeout" type="number" min="500" max="5000" step="100" value="1000" />
            <div class="note" data-i18n="silence_note">Time to wait after you stop speaking before sending.</div>

            <label style="margin-top:6px;" data-i18n="grace_window_label">Grace window (ms)</label>
            <input id="grace-ms" type="number" min="0" max="2000" step="50" value="450" />
            <div class="note" data-i18n="grace_window_note">
                Prevents late results after cancel/stop when grace is enabled.
            </div>

            <div class="checkbox-wrapper">
                <input type="checkbox" id="enable-hardcap" />
                <label for="enable-hardcap" class="checkbox-label" data-i18n="enable_hardcap_label">Enable 5s hard
                    cap</label>
            </div>
            <div class="note" data-i18n="enable_hardcap_note">Voice Recordings have a fixed 5s limit.</div>
            <div class="checkbox-wrapper">
                <input type="checkbox" id="disable-grace-window" />
                <label for="disable-grace-window" class="checkbox-label" data-i18n="disable_grace_label">Disable grace
                    window</label>
            </div>
            <div class="note" data-i18n="disable_grace_note">Grace is enabled; set grace ms above.</div>

                        <div class="checkbox-wrapper">
                <input type="checkbox" id="assemblyai-streaming" />
                <label for="assemblyai-streaming" class="checkbox-label" data-i18n="disable_assemblyai_streaming_label">Disable AssemblyAI realtime streaming</label>
            </div>
            <div class="note" data-i18n="assemblyai_streaming_note">Streams live audio to AssemblyAI and emits partial results like Chrome.</div>

            <div class="checkbox-wrapper" style="margin-top:6px;">
                <input type="checkbox" id="assemblyai-streaming-multilingual" />
                <label for="assemblyai-streaming-multilingual" class="checkbox-label" data-i18n="disable_assemblyai_multilingual_label">
                    Disable AssemblyAI multilingual streaming model
                </label>
            </div>
            <div class="note" data-i18n="assemblyai_streaming_multilingual_note">Enables universal-streaming-multilingual with language detection.</div>

            <div class="notesep" style="margin-top:14px; font-weight:600; font-style: italic;" data-i18n="streaming_silence_timeout">Streaming silence timeout</div>
            <div class="note" data-i18n="streaming_applies_note">Applies to streaming providers (Vosk + AssemblyAI).</div>

            <div class="checkbox-wrapper" style="margin-top:10px;">
                <input type="checkbox" id="assemblyai-streaming-silence-never" />
                <label for="assemblyai-streaming-silence-never" class="checkbox-label" data-i18n="assemblyai_streaming_silence_never_label">
                    Never apply silence timeout for streaming
                </label>
            </div>
            <div class="checkbox-wrapper" style="margin-top:6px;">
                <input type="checkbox" id="assemblyai-streaming-silence-partial" />
                <label for="assemblyai-streaming-silence-partial" class="checkbox-label" data-i18n="assemblyai_streaming_silence_partial_label">
                    Silence timeout only when started by site UI but not hotkey (Deterministic)
                </label>
            </div>
            <div class="checkbox-wrapper" style="margin-top:6px;">
                <input type="checkbox" id="assemblyai-streaming-silence-always" />
                <label for="assemblyai-streaming-silence-always" class="checkbox-label" data-i18n="assemblyai_streaming_silence_always_label">
                    Always apply silence timeout for streaming
                </label>
            </div>




            <div class="status" id="status-speech-logic" data-i18n="status_saved">Saved</div>
        </div>

        <div class="card">
            <div class="section-header">
                <span class="icon icon-layers" aria-hidden="true"></span>
                <span data-i18n="section_overrides">Site Overrides</span>
            </div>
            <div class="note overrides-note" data-i18n="overrides_note">Override model, language, or engine per site.
            </div>

            <div class="actions">
                <div>
                    <label style="margin-top:0" data-i18n="hostname">Hostname</label>
                    <input id="override-host" type="text" data-i18n-placeholder="hostname_placeholder"
                        placeholder="example.com" />
                </div>

                            <div class="actions" style="margin-top: 8px;">
                <div style="flex:1">
                    <label style="margin-top:0" data-i18n="engine_label">Provider</label>
                    <select id="override-provider">
                        <option value="" data-i18n="override_default_option">(Default)</option>
                        <option value="local-whisper" data-i18n="engine_local">Whisper</option>
                        <option value="vosk" data-i18n="engine_vosk">Vosk (Streaming)</option>
                        <option value="assemblyai" data-i18n="engine_assemblyai">Server AssemblyAI</option>
                    </select>
                </div>
            </div>

                <div>
                    <label style="margin-top:0" data-i18n="model_label">Model</label>
                    <select id="override-model">
                        <option value="" data-i18n="override_default_option">(Default)</option>
                            <option value="Xenova/whisper-tiny.en" data-i18n="model_tiny_en">Tiny English (~75MB)
                            </option>
                            <option value="Xenova/whisper-base.en" data-i18n="model_base_en">Base English (~150MB)
                            </option>
                            <option value="Xenova/distil-whisper-medium.en" data-i18n="model_distil_en">Distil-Medium
                                English (~600MB)</option>
                            <option value="Xenova/whisper-small.en" data-i18n="model_small_en">Small English (~500MB)
                            </option>
                            <option value="Xenova/whisper-tiny" data-i18n="model_tiny_multi">Tiny Multilingual (~150MB)
                            </option>
                            <option value="Xenova/whisper-base" data-i18n="model_base_multi">Base Multilingual (~290MB)
                            </option>
                            <option value="Xenova/whisper-small" data-i18n="model_small_multi">Small Multilingual (~1GB)
                            </option>
                    </select>
                </div>
            </div>

            <div class="actions" style="margin-top: 8px;">
                <div style="flex:1">
                    <label style="margin-top:0" data-i18n="vosk_model_label_short">Vosk model (type to search)</label>
                    <input id="override-vosk-model" list="vosk-model-list" type="text"
                        placeholder="vosk-model-small-en-us-0.15" type="password" autocomplete="new-password" autocorrect="off" autocapitalize="off" spellcheck="false" data-lpignore="true"  />
                </div>
            </div>

            <div class="actions" style="margin-top: 8px;">
                <div style="flex:1">
                    <label style="margin-top:0" data-i18n="language_label">Language</label>
                    <select id="override-language">
                        <option value="" data-i18n="override_default_option">(Default)</option>
                        <option value="auto" data-i18n="lang_auto">Auto</option>
                        <option value="en" data-i18n="lang_en">English</option>
                        <option value="es" data-i18n="lang_es">Spanish</option>
                        <option value="fr" data-i18n="lang_fr">French</option>
                        <option value="de" data-i18n="lang_de">German</option>
                        <option value="it" data-i18n="lang_it">Italian</option>
                        <option value="pt" data-i18n="lang_pt">Portuguese</option>
                        <option value="ja" data-i18n="lang_ja">Japanese</option>
                        <option value="zh" data-i18n="lang_zh">Chinese</option>
                        <option value="ru" data-i18n="lang_ru">Russian</option>
                    </select>
                </div>
                <div style="flex:1">
                    <label style="margin-top:0" data-i18n="timeout_label">Silence Timeout (ms)</label>
                    <input id="override-timeout" type="number" data-i18n-placeholder="override_timeout_placeholder"
                        placeholder="(Default)" />
                </div>
                <div style="flex:1">
                    <label style="margin-top:0" data-i18n="grace_window_label">Grace window (ms)</label>
                    <input id="override-grace" type="number" placeholder="(Default)" />
                </div>
            </div>



            <div class="actions" style="margin-top: 8px;">
                <div style="flex:1">
                    <label style="margin-top:0; display:flex; align-items:center; gap:6px;"
                        data-i18n="override_status_label">Extension Status</label>
                    <select id="override-status">
                        <option value="" selected data-i18n="override_status_default">(Default: Enabled)</option>
                        <option value="disabled" data-i18n="override_status_disabled">Disabled</option>
                    </select>
                </div>
            </div>

            <div class="actions overrides-actions">
                <button id="add-override" style="margin-top:0; flex:1;" data-i18n="add_rule">Add Rules</button>
                <button id="clear-override-inputs" class="btn-secondary" style="margin-top:0; flex:1;"
                    data-i18n="clear_inputs">Clear Inputs</button>
                <button id="remove-override" class="btn-danger" style="margin-top:0;" data-i18n="remove_rule">Remove All
                    Rules</button>
            </div>

            <div class="collapse-header">
                <div class="collapse-title">
                    <span data-i18n="overrides_list_title">Saved overrides</span>
                    <span class="note" id="overrides-count" style="margin-top:0;">(0)</span>
                </div>
                <button id="toggle-overrides-list" type="button" class="collapse-btn" data-i18n="show">
                    Show
                </button>
            </div>

            <div id="overrides-list-body" class="collapse-body">
                <table id="override-table">
                    <thead>
                        <tr>
                            <th data-i18n="table_host">Host</th>
                            <th data-i18n="table_enabled">Enabled</th>
                            <th data-i18n="table_model">Model</th>
                            <th data-i18n="table_lang">Lang</th>
                            <th data-i18n="table_timeout">Timeout</th>
                            <th data-i18n="table_grace">Grace</th>
                            <th data-i18n="table_engine">Provider</th>
                            <th data-i18n="table_remove" aria-label="Remove"></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="status" id="status-overrides" data-i18n="status_saved">Saved</div>
        </div>

        <div class="card">
            <div class="section-header">
                <span class="icon icon-terminal" aria-hidden="true"></span>
                <span data-i18n="section_developer">Developer Settings</span>
            </div>
            <div class="note" data-i18n="developer_note">Advanced toggles for debugging and experimental behavior.
                Sorted by understandability.</div>

            <div id="backend-indicator" class="backend-indicator warn" aria-live="polite">
                <div class="left">
                    <span class="icon icon-gpu" aria-hidden="true"></span>
                    <div style="min-width:0;">
                        <div style="display:flex; align-items:baseline; gap:8px; flex-wrap:wrap;">
                            <span class="label" data-i18n="backend_indicator_label">Local Whisper backend:</span>
                            <span class="value" id="backend-value"
                                data-i18n="backend_indicator_value_unknown">Unknown</span>
                        </div>
                        <div class="hint" id="backend-hint" data-i18n="backend_hint_default">
                            Runs on WebGPU when available; falls back to WASM if not supported.
                        </div>
                    </div>
                </div>
                <span class="backend-chip" id="backend-chip" style="color: var(--backend-warn-text);">
                    <span class="dot" aria-hidden="true"></span>
                    <span id="backend-chip-text" data-i18n="backend_chip_unknown">Unknown</span>
                </span>
            </div>


            <div class="checkbox-wrapper">
                <input type="checkbox" id="debug-mode" />
                <label for="debug-mode" class="checkbox-label" data-i18n="debug_logs">Enable debug logs</label>
            </div>
            <div class="note" data-i18n="debug_logs_note">
                Logs detailed background/content script messages to the console.
            </div>

 
            <div class="checkbox-wrapper">
                <input type="checkbox" id="toast-notifications" />
                <label for="toast-notifications" class="checkbox-label" data-i18n="toast_toggle">Enable toast
                    notifications</label>
            </div>
            <div class="note" data-i18n="toast_toggle_note">
                Show on-page status toasts (recording/processing/errors).
            </div>

            <div class="checkbox-wrapper">
                <input type="checkbox" id="hide-warning-banner" />
                <label for="hide-warning-banner" class="checkbox-label" data-i18n="hide_banner">Hide top warning
                    banner</label>
            </div>
            <div class="note" data-i18n="hide_banner_note">Removes the alert banner at the top of this page.</div>

            <div class="checkbox-wrapper">
                <input type="checkbox" id="disable-favicons" />
                <label for="disable-favicons" class="checkbox-label" data-i18n="disable_favicons_label">Disable favicons
                    in overrides table</label>
            </div>
            <div class="note" data-i18n="disable_favicons_note">Favicons are shown by default. Enable to hide favicons.
            </div>

            <div class="checkbox-wrapper">
    <input type="checkbox" id="disable-processing-timeouts" />
    <label for="disable-processing-timeouts" class="checkbox-label" data-i18n="disable_processing_timeouts_label">
        Disable ultimatum processing timeouts
    </label>
</div>
<div class="note" data-i18n="disable_processing_timeouts_note">
    Disables the content-script watchdog and background ultimatum processing timeout checks. May make the extension unreponsive, though useful for recording long sessions.
</div>

            <div class="status" id="status-dev" data-i18n="status_saved">Saved</div>
        </div>

        <div class="card">
            <div class="section-header">
                <span class="icon icon-save" aria-hidden="true"></span>
                <span data-i18n="section_save_reset">Data</span>
            </div>
            <div class="note" data-i18n="data_note">Export/import settings as JSON or reset to defaults. Prebuilt
                Overrides are also included
                <a href="https://github.com/apersongithub/Speech-Recognition-Polyfill/tree/main/prebuilt-overrides"
                    target="_blank"><strong data-i18n="link_here">HERE!</strong></a>
            </div>

            <div class="two-btn-row">
                <button id="export-settings" type="button" data-i18n="export_settings">Export</button>
                <button id="import-settings" type="button" class="btn-secondary"
                    data-i18n="import_settings">Import</button>
                <input id="import-file" type="file" accept="application/json" style="display:none" />
            </div>

            <button id="factory-reset" class="btn-danger" type="button" data-i18n="factory_reset">Factory Reset</button>
            <div class="status" id="status-save" data-i18n="status_saved">Saved</div>
        </div>
    </div>

    <datalist id="vosk-model-list"></datalist>

    <script src="options.js"></script>
</body>

</html>